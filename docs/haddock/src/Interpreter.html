<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module: Interpreter
Description: Internal logic of the interpreter
License: GPL-3

This module contains auxiliary logic, types and representations of
the internal state of the interpreter.
-}</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Interpreter</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">(</span><span>  </span><span>
</span><a name="line-11"></a><span>  </span><span class="hs-comment">-- * Interpreter actions</span><span>
</span><a name="line-12"></a><span>    </span><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier hs-type">InterpreterAction</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#interpreteractionParser"><span class="hs-identifier hs-var">interpreteractionParser</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#act"><span class="hs-identifier hs-var">act</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#multipleAct"><span class="hs-identifier hs-var">multipleAct</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#actionParser"><span class="hs-identifier hs-var">actionParser</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#executeWithEnv"><span class="hs-identifier hs-var">executeWithEnv</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#librariesEnv"><span class="hs-identifier hs-var">librariesEnv</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#preformat"><span class="hs-identifier hs-var">preformat</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">where</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Applicative</span><span>           </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;*&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">State</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>      </span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">ParserCombinators</span><span class="hs-operator">.</span><span class="hs-identifier">Parsec</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">State</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="Format.html"><span class="hs-identifier">Format</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Environment.html"><span class="hs-identifier">Environment</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><a href="NamedLambda.html"><span class="hs-identifier">NamedLambda</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><a href="Lambda.html"><span class="hs-identifier">Lambda</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><a href="Libraries.html"><span class="hs-identifier">Libraries</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><a href="Ski.html"><span class="hs-identifier">Ski</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span>           </span><a href="Stlc.Types.html"><span class="hs-identifier">Stlc</span><span class="hs-operator">.</span><span class="hs-identifier">Types</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><a href="Stlc.Gentzen.html"><span class="hs-identifier">Stlc</span><span class="hs-operator">.</span><span class="hs-identifier">Gentzen</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- | Execute a block of code in a given environment</span><span>
</span><a name="line-40"></a><span class="hs-identifier">executeWithEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span class="hs-special">)</span><span>
</span><a name="line-41"></a><a name="executeWithEnv"><a href="Interpreter.html#executeWithEnv"><span class="hs-identifier">executeWithEnv</span></a></a><span> </span><a name="local-6989586621679033504"><a href="#local-6989586621679033504"><span class="hs-identifier">initEnv</span></a></a><span> </span><a name="local-6989586621679033505"><a href="#local-6989586621679033505"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-42"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033506"><a href="#local-6989586621679033506"><span class="hs-identifier">parsing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">parse</span><span> </span><a href="Interpreter.html#actionParser"><span class="hs-identifier hs-var">actionParser</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Interpreter.html#preformat"><span class="hs-identifier hs-var">preformat</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679033505"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-43"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033507"><a href="#local-6989586621679033507"><span class="hs-identifier">actions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679033508"><a href="#local-6989586621679033508"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679033508"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-44"></a><span>                             </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-45"></a><span>                             </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679033636"><a href="#local-6989586621679033636"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679033636"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033506"><span class="hs-identifier hs-var">parsing</span></a><span>
</span><a name="line-46"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">runState</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#multipleAct"><span class="hs-identifier hs-var">multipleAct</span></a><span> </span><a href="#local-6989586621679033507"><span class="hs-identifier hs-var">actions</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033504"><span class="hs-identifier hs-var">initEnv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-47"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679033637"><a href="#local-6989586621679033637"><span class="hs-identifier">outputs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679033638"><a href="#local-6989586621679033638"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unlines</span><span> </span><a href="#local-6989586621679033637"><span class="hs-identifier hs-var">outputs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679033638"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- | Default environment plus standard libraries</span><span>
</span><a name="line-50"></a><span class="hs-identifier">librariesEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span>
</span><a name="line-51"></a><a name="librariesEnv"><a href="Interpreter.html#librariesEnv"><span class="hs-identifier">librariesEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Interpreter.html#executeWithEnv"><span class="hs-identifier hs-var">executeWithEnv</span></a><span> </span><a href="Environment.html#defaultEnv"><span class="hs-identifier hs-var">defaultEnv</span></a><span> </span><a href="Libraries.html#stdlibraries"><span class="hs-identifier hs-var">stdlibraries</span></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">-- | Preformats text before sending it to the interpreter</span><span>
</span><a name="line-54"></a><span class="hs-identifier">preformat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-55"></a><a name="preformat"><a href="Interpreter.html#preformat"><span class="hs-identifier">preformat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-char">' '</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-char">' '</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">-- | Interpreter action. It can be a language action (binding and evaluation)</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- or an interpreter specific one, such as &quot;quit&quot;.</span><span>
</span><a name="line-59"></a><span class="hs-keyword">data</span><span> </span><a name="InterpreterAction"><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier">InterpreterAction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Interpret"><a href="Interpreter.html#Interpret"><span class="hs-identifier">Interpret</span></a></a><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span> </span><span class="hs-comment">-- ^ Language action</span><span>
</span><a name="line-60"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a name="Quit"><a href="Interpreter.html#Quit"><span class="hs-identifier">Quit</span></a></a><span>             </span><span class="hs-comment">-- ^ Close the interpreter</span><span>
</span><a name="line-61"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a name="Load"><a href="Interpreter.html#Load"><span class="hs-identifier">Load</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>      </span><span class="hs-comment">-- ^ Load the given file</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- | Language action. The language has a number of possible valid statements;</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- all on the following possible forms.</span><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="Action"><a href="Interpreter.html#Action"><span class="hs-identifier">Action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Bind"><a href="Interpreter.html#Bind"><span class="hs-identifier">Bind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ bind a name to an expression</span><span>
</span><a name="line-66"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="EvalBind"><a href="Interpreter.html#EvalBind"><span class="hs-identifier">EvalBind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ bind a name to an expression and simplify it</span><span>
</span><a name="line-67"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Execute"><a href="Interpreter.html#Execute"><span class="hs-identifier">Execute</span></a></a><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span>            </span><span class="hs-comment">-- ^ execute an expression</span><span>
</span><a name="line-68"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Diagram"><a href="Interpreter.html#Diagram"><span class="hs-identifier">Diagram</span></a></a><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span>            </span><span class="hs-comment">-- ^ show the diagram of a lambda expression</span><span>
</span><a name="line-69"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SimpDiagram"><a href="Interpreter.html#SimpDiagram"><span class="hs-identifier">SimpDiagram</span></a></a><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span>        </span><span class="hs-comment">-- ^ show the diagram of the simplified expression</span><span>
</span><a name="line-70"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Comment"><a href="Interpreter.html#Comment"><span class="hs-identifier">Comment</span></a></a><span>                        </span><span class="hs-comment">-- ^ comment</span><span>
</span><a name="line-71"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="EmptyLine"><a href="Interpreter.html#EmptyLine"><span class="hs-identifier">EmptyLine</span></a></a><span>                      </span><span class="hs-comment">-- ^ empty line, it will be ignored</span><span>
</span><a name="line-72"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Error"><a href="Interpreter.html#Error"><span class="hs-identifier">Error</span></a></a><span>                          </span><span class="hs-comment">-- ^ error on the interpreter</span><span>
</span><a name="line-73"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Restart"><a href="Interpreter.html#Restart"><span class="hs-identifier">Restart</span></a></a><span>                        </span><span class="hs-comment">-- ^ restarts the environment</span><span>
</span><a name="line-74"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="Help"><a href="Interpreter.html#Help"><span class="hs-identifier">Help</span></a></a><span>                           </span><span class="hs-comment">-- ^ shows help</span><span>
</span><a name="line-75"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SetVerbose"><a href="Interpreter.html#SetVerbose"><span class="hs-identifier">SetVerbose</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                </span><span class="hs-comment">-- ^ changes verbosity</span><span>
</span><a name="line-76"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SetColor"><a href="Interpreter.html#SetColor"><span class="hs-identifier">SetColor</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                  </span><span class="hs-comment">-- ^ changes colors</span><span>
</span><a name="line-77"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SetSki"><a href="Interpreter.html#SetSki"><span class="hs-identifier">SetSki</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                    </span><span class="hs-comment">-- ^ changes ski output</span><span>
</span><a name="line-78"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SetTypes"><a href="Interpreter.html#SetTypes"><span class="hs-identifier">SetTypes</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>                  </span><span class="hs-comment">-- ^ changes type configuration</span><span>
</span><a name="line-79"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="SetTopo"><a href="Interpreter.html#SetTopo"><span class="hs-identifier">SetTopo</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>              </span><span>
</span><a name="line-82"></a><span class="hs-comment">-- | Executes a language action. Given a context and an action, returns</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- the new context after the action and a text output.</span><span>
</span><a name="line-84"></a><span class="hs-identifier">act</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">State</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-85"></a><a name="act"><a href="Interpreter.html#act"><span class="hs-identifier">act</span></a></a><span> </span><a href="Interpreter.html#Comment"><span class="hs-identifier hs-var">Comment</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679033639"><a href="#local-6989586621679033639"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679033640"><a href="#local-6989586621679033640"><span class="hs-identifier">le</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679033853"><a href="#local-6989586621679033853"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Environment.html#addBind"><span class="hs-identifier hs-var">addBind</span></a><span> </span><a href="#local-6989586621679033853"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679033639"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="NamedLambda.html#toBruijn"><span class="hs-identifier hs-var">toBruijn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">context</span><span> </span><a href="#local-6989586621679033853"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033640"><span class="hs-identifier hs-var">le</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-89"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#EvalBind"><span class="hs-identifier hs-var">EvalBind</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679033854"><a href="#local-6989586621679033854"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><a name="local-6989586621679033855"><a href="#local-6989586621679033855"><span class="hs-identifier">le</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679033856"><a href="#local-6989586621679033856"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Environment.html#addBind"><span class="hs-identifier hs-var">addBind</span></a><span> </span><a href="#local-6989586621679033856"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679033854"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="Lambda.html#simplifyAll"><span class="hs-identifier hs-var">simplifyAll</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="NamedLambda.html#toBruijn"><span class="hs-identifier hs-var">toBruijn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">context</span><span> </span><a href="#local-6989586621679033856"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033855"><span class="hs-identifier hs-var">le</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-92"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#Execute"><span class="hs-identifier hs-var">Execute</span></a><span> </span><a name="local-6989586621679033857"><a href="#local-6989586621679033857"><span class="hs-identifier">le</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#executeExpression"><span class="hs-identifier hs-var">executeExpression</span></a><span> </span><a href="#local-6989586621679033857"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-93"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#Diagram"><span class="hs-identifier hs-var">Diagram</span></a><span> </span><a name="local-6989586621679033858"><a href="#local-6989586621679033858"><span class="hs-identifier">le</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#drawDiagram"><span class="hs-identifier hs-var">drawDiagram</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621679033858"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-94"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SimpDiagram"><span class="hs-identifier hs-var">SimpDiagram</span></a><span> </span><a name="local-6989586621679033859"><a href="#local-6989586621679033859"><span class="hs-identifier">le</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#drawDiagram"><span class="hs-identifier hs-var">drawDiagram</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679033859"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-95"></a><span class="hs-identifier">act</span><span> </span><a href="Interpreter.html#EmptyLine"><span class="hs-identifier hs-var">EmptyLine</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-96"></a><span class="hs-identifier">act</span><span> </span><a href="Interpreter.html#Error"><span class="hs-identifier hs-var">Error</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorUnknownCommand"><span class="hs-identifier hs-var">errorUnknownCommand</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-97"></a><span class="hs-identifier">act</span><span> </span><a href="Interpreter.html#Restart"><span class="hs-identifier hs-var">Restart</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">put</span><span> </span><a href="Environment.html#defaultEnv"><span class="hs-identifier hs-var">defaultEnv</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Format.html#restartText"><span class="hs-identifier hs-var">restartText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-98"></a><span class="hs-identifier">act</span><span> </span><a href="Interpreter.html#Help"><span class="hs-identifier hs-var">Help</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Format.html#helpText"><span class="hs-identifier hs-var">helpText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-99"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SetVerbose"><span class="hs-identifier hs-var">SetVerbose</span></a><span> </span><a name="local-6989586621679033860"><a href="#local-6989586621679033860"><span class="hs-identifier">setting</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#setOption"><span class="hs-identifier hs-var">setOption</span></a><span> </span><a href="#local-6989586621679033860"><span class="hs-identifier hs-var">setting</span></a><span> </span><a href="Environment.html#changeVerbose"><span class="hs-identifier hs-var">changeVerbose</span></a><span> </span><span class="hs-string">&quot;verbose: &quot;</span><span>
</span><a name="line-100"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SetColor"><span class="hs-identifier hs-var">SetColor</span></a><span> </span><a name="local-6989586621679033861"><a href="#local-6989586621679033861"><span class="hs-identifier">setting</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#setOption"><span class="hs-identifier hs-var">setOption</span></a><span> </span><a href="#local-6989586621679033861"><span class="hs-identifier hs-var">setting</span></a><span> </span><a href="Environment.html#changeColor"><span class="hs-identifier hs-var">changeColor</span></a><span> </span><span class="hs-string">&quot;color mode: &quot;</span><span>
</span><a name="line-101"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SetSki"><span class="hs-identifier hs-var">SetSki</span></a><span> </span><a name="local-6989586621679033862"><a href="#local-6989586621679033862"><span class="hs-identifier">setting</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#setOption"><span class="hs-identifier hs-var">setOption</span></a><span> </span><a href="#local-6989586621679033862"><span class="hs-identifier hs-var">setting</span></a><span> </span><a href="Environment.html#changeSkioutput"><span class="hs-identifier hs-var">changeSkioutput</span></a><span> </span><span class="hs-string">&quot;ski mode: &quot;</span><span>
</span><a name="line-102"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SetTypes"><span class="hs-identifier hs-var">SetTypes</span></a><span> </span><a name="local-6989586621679033863"><a href="#local-6989586621679033863"><span class="hs-identifier">setting</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#setOption"><span class="hs-identifier hs-var">setOption</span></a><span> </span><a href="#local-6989586621679033863"><span class="hs-identifier hs-var">setting</span></a><span> </span><a href="Environment.html#changeTypes"><span class="hs-identifier hs-var">changeTypes</span></a><span> </span><span class="hs-string">&quot;types: &quot;</span><span>
</span><a name="line-103"></a><span class="hs-identifier">act</span><span> </span><span class="hs-special">(</span><a href="Interpreter.html#SetTopo"><span class="hs-identifier hs-var">SetTopo</span></a><span> </span><a name="local-6989586621679033864"><a href="#local-6989586621679033864"><span class="hs-identifier">setting</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#setOption"><span class="hs-identifier hs-var">setOption</span></a><span> </span><a href="#local-6989586621679033864"><span class="hs-identifier hs-var">setting</span></a><span> </span><a href="Environment.html#changeTopo"><span class="hs-identifier hs-var">changeTopo</span></a><span> </span><span class="hs-string">&quot;topology: &quot;</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- | Sets the given option on/off.</span><span>
</span><a name="line-107"></a><span class="hs-identifier">setOption</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-108"></a><span>             </span><span class="hs-special">(</span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-109"></a><span>             </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-110"></a><span>             </span><span class="hs-identifier hs-type">State</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-111"></a><a name="setOption"><a href="Interpreter.html#setOption"><span class="hs-identifier">setOption</span></a></a><span> </span><a name="local-6989586621679033865"><a href="#local-6989586621679033865"><span class="hs-identifier">setting</span></a></a><span> </span><a name="local-6989586621679033866"><a href="#local-6989586621679033866"><span class="hs-identifier">change</span></a></a><span> </span><a name="local-6989586621679033867"><a href="#local-6989586621679033867"><span class="hs-identifier">message</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="#local-6989586621679033866"><span class="hs-identifier hs-var">change</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679033865"><span class="hs-identifier hs-var">setting</span></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>  </span><a name="local-6989586621679033870"><a href="#local-6989586621679033870"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679033868"><span class="hs-identifier hs-var">messageenv</span></a><span> </span><a href="#local-6989586621679033870"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679033868"><a href="#local-6989586621679033868"><span class="hs-identifier">messageenv</span></a></a><span> </span><a name="local-6989586621679033869"><a href="#local-6989586621679033869"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-116"></a><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="Environment.html#getColor"><span class="hs-identifier hs-var">getColor</span></a><span> </span><a href="#local-6989586621679033869"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#formatFormula"><span class="hs-identifier hs-var">formatFormula</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679033867"><span class="hs-identifier hs-var">message</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-117"></a><span>            </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033865"><span class="hs-identifier hs-var">setting</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;on&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;off&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Format.html#end"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">drawDiagram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">State</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-120"></a><a name="drawDiagram"><a href="Interpreter.html#drawDiagram"><span class="hs-identifier">drawDiagram</span></a></a><span> </span><a name="local-6989586621679033871"><a href="#local-6989586621679033871"><span class="hs-identifier">wantsimplification</span></a></a><span> </span><a name="local-6989586621679033872"><a href="#local-6989586621679033872"><span class="hs-identifier">le</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-121"></a><span>  </span><a name="local-6989586621679033873"><a href="#local-6989586621679033873"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033874"><a href="#local-6989586621679033874"><span class="hs-identifier">bruijn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NamedLambda.html#toBruijn"><span class="hs-identifier hs-var">toBruijn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">context</span><span> </span><a href="#local-6989586621679033873"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033872"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-123"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033875"><a href="#local-6989586621679033875"><span class="hs-identifier">isopen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lambda.html#isOpenExp"><span class="hs-identifier hs-var">isOpenExp</span></a><span> </span><a href="#local-6989586621679033874"><span class="hs-identifier hs-var">bruijn</span></a><span>
</span><a name="line-124"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033876"><a href="#local-6989586621679033876"><span class="hs-identifier">simpbruijn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lambda.html#simplifyAll"><span class="hs-identifier hs-var">simplifyAll</span></a><span> </span><a href="#local-6989586621679033874"><span class="hs-identifier hs-var">bruijn</span></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033877"><a href="#local-6989586621679033877"><span class="hs-identifier">maybediagram</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Stlc.Gentzen.html#gentzendiagram"><span class="hs-identifier hs-var">gentzendiagram</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033871"><span class="hs-identifier hs-var">wantsimplification</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679033876"><span class="hs-identifier hs-var">simpbruijn</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679033874"><span class="hs-identifier hs-var">bruijn</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033875"><span class="hs-identifier hs-var">isopen</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorUndefinedText"><span class="hs-identifier hs-var">errorUndefinedText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-129"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679033877"><span class="hs-identifier hs-var">maybediagram</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorNonTypeableText"><span class="hs-identifier hs-var">errorNonTypeableText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679033878"><a href="#local-6989586621679033878"><span class="hs-identifier">diagram</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Stlc.Gentzen.html#showProofTree"><span class="hs-identifier hs-var">showProofTree</span></a><span> </span><a href="#local-6989586621679033878"><span class="hs-identifier hs-var">diagram</span></a><span>
</span><a name="line-132"></a><span>  </span><span>
</span><a name="line-133"></a><span class="hs-comment">-- | Executes a lambda expression. Given the context, returns the new</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- context after the evaluation.</span><span>
</span><a name="line-135"></a><span class="hs-identifier">executeExpression</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NamedLambda.html#NamedLambda"><span class="hs-identifier hs-type">NamedLambda</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">State</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-136"></a><a name="executeExpression"><a href="Interpreter.html#executeExpression"><span class="hs-identifier">executeExpression</span></a></a><span> </span><a name="local-6989586621679033879"><a href="#local-6989586621679033879"><span class="hs-identifier">le</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-137"></a><span>     </span><a name="local-6989586621679033880"><a href="#local-6989586621679033880"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-138"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033881"><a href="#local-6989586621679033881"><span class="hs-identifier">typed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getTypes"><span class="hs-identifier hs-var">getTypes</span></a><span> </span><a href="#local-6989586621679033880"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-139"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033882"><a href="#local-6989586621679033882"><span class="hs-identifier">bruijn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NamedLambda.html#toBruijn"><span class="hs-identifier hs-var">toBruijn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">context</span><span> </span><a href="#local-6989586621679033880"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679033879"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-140"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033883"><a href="#local-6989586621679033883"><span class="hs-identifier">illtyped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679033881"><span class="hs-identifier hs-var">typed</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span> </span><span class="hs-special">(</span><a href="Stlc.Types.html#typeinference"><span class="hs-identifier hs-var">typeinference</span></a><span> </span><a href="#local-6989586621679033882"><span class="hs-identifier hs-var">bruijn</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033884"><a href="#local-6989586621679033884"><span class="hs-identifier">notypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679033881"><span class="hs-identifier hs-var">typed</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Lambda.html#usestypecons"><span class="hs-identifier hs-var">usestypecons</span></a><span> </span><a href="#local-6989586621679033882"><span class="hs-identifier hs-var">bruijn</span></a><span>
</span><a name="line-142"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033885"><a href="#local-6989586621679033885"><span class="hs-identifier">verbose</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getVerbose"><span class="hs-identifier hs-var">getVerbose</span></a><span> </span><a href="#local-6989586621679033880"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-143"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033886"><a href="#local-6989586621679033886"><span class="hs-identifier">completeexp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#showCompleteExp"><span class="hs-identifier hs-var">showCompleteExp</span></a><span> </span><a href="#local-6989586621679033880"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lambda.html#simplifyAll"><span class="hs-identifier hs-var">simplifyAll</span></a><span> </span><a href="#local-6989586621679033882"><span class="hs-identifier hs-var">bruijn</span></a><span>
</span><a name="line-144"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033887"><a href="#local-6989586621679033887"><span class="hs-identifier">isopen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Lambda.html#isOpenExp"><span class="hs-identifier hs-var">isOpenExp</span></a><span> </span><a href="#local-6989586621679033882"><span class="hs-identifier hs-var">bruijn</span></a><span>
</span><a name="line-145"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033888"><a href="#local-6989586621679033888"><span class="hs-identifier">coloring</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getColor"><span class="hs-identifier hs-var">getColor</span></a><span> </span><a href="#local-6989586621679033880"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-146"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679033889"><a href="#local-6989586621679033889"><span class="hs-identifier">decolorif</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033888"><span class="hs-identifier hs-var">coloring</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#decolor"><span class="hs-identifier hs-var">decolor</span></a><span>
</span><a name="line-147"></a><span>     </span><span>
</span><a name="line-148"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-149"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033887"><span class="hs-identifier hs-var">isopen</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorUndefinedText"><span class="hs-identifier hs-var">errorUndefinedText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-150"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033883"><span class="hs-identifier hs-var">illtyped</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorNonTypeableText"><span class="hs-identifier hs-var">errorNonTypeableText</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-151"></a><span>       </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679033884"><span class="hs-identifier hs-var">notypes</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Format.html#errorTypeConstructors"><span class="hs-identifier hs-var">errorTypeConstructors</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-152"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621679033885"><span class="hs-identifier hs-var">verbose</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679033886"><span class="hs-identifier hs-var">completeexp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-153"></a><span>         </span><span class="hs-special">[</span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-154"></a><span>           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679033879"><span class="hs-identifier hs-var">le</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-155"></a><span>           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679033889"><span class="hs-identifier hs-var">decolorif</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Lambda.html#showReduction"><span class="hs-identifier hs-var">showReduction</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Lambda.html#simplifySteps"><span class="hs-identifier hs-var">simplifySteps</span></a><span> </span><a href="#local-6989586621679033882"><span class="hs-identifier hs-var">bruijn</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-156"></a><span>           </span><span class="hs-special">[</span><a href="#local-6989586621679033886"><span class="hs-identifier hs-var">completeexp</span></a><span class="hs-special">]</span><span>
</span><a name="line-157"></a><span>         </span><span class="hs-special">]</span><span>
</span><a name="line-158"></a><span>  </span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | Executes multiple actions. Given a context and a set of actions, returns</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- the new context after the sequence of actions and a text output.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">multipleAct</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">State</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-163"></a><a name="multipleAct"><a href="Interpreter.html#multipleAct"><span class="hs-identifier">multipleAct</span></a></a><span> </span><a name="local-6989586621679033890"><a href="#local-6989586621679033890"><span class="hs-identifier">actions</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="Interpreter.html#act"><span class="hs-identifier hs-var">act</span></a><span> </span><a href="#local-6989586621679033890"><span class="hs-identifier hs-var">actions</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- | Shows an expression and the name that is bound to the expression</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- in the current context</span><span>
</span><a name="line-168"></a><span class="hs-identifier">showCompleteExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Environment.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Lambda.html#Exp"><span class="hs-identifier hs-type">Exp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-169"></a><a name="showCompleteExp"><a href="Interpreter.html#showCompleteExp"><span class="hs-identifier">showCompleteExp</span></a></a><span> </span><a name="local-6989586621679034452"><a href="#local-6989586621679034452"><span class="hs-identifier">environment</span></a></a><span> </span><a name="local-6989586621679034453"><a href="#local-6989586621679034453"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-170"></a><span>  </span><a href="#local-6989586621679034458"><span class="hs-identifier hs-var">lambdaname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679034459"><span class="hs-identifier hs-var">skiname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679034462"><span class="hs-identifier hs-var">expName</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679034461"><span class="hs-identifier hs-var">typename</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Format.html#end"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-171"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-172"></a><span>    </span><a name="local-6989586621679034454"><a href="#local-6989586621679034454"><span class="hs-identifier">coloring</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getColor"><span class="hs-identifier hs-var">getColor</span></a><span> </span><a href="#local-6989586621679034452"><span class="hs-identifier hs-var">environment</span></a><span>
</span><a name="line-173"></a><span>    </span><a name="local-6989586621679034455"><a href="#local-6989586621679034455"><span class="hs-identifier">ifvoid</span></a></a><span> </span><a name="local-6989586621679034463"><a href="#local-6989586621679034463"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679034464"><a href="#local-6989586621679034464"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679034463"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679034464"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-6989586621679034456"><a href="#local-6989586621679034456"><span class="hs-identifier">typesset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getTypes"><span class="hs-identifier hs-var">getTypes</span></a><span> </span><a href="#local-6989586621679034452"><span class="hs-identifier hs-var">environment</span></a><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679034457"><a href="#local-6989586621679034457"><span class="hs-identifier">skiset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Environment.html#getSki"><span class="hs-identifier hs-var">getSki</span></a><span> </span><a href="#local-6989586621679034452"><span class="hs-identifier hs-var">environment</span></a><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679034458"><a href="#local-6989586621679034458"><span class="hs-identifier">lambdaname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="NamedLambda.html#nameExp"><span class="hs-identifier hs-var">nameExp</span></a><span> </span><a href="#local-6989586621679034453"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-177"></a><span>    </span><a name="local-6989586621679034459"><a href="#local-6989586621679034459"><span class="hs-identifier">skiname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034455"><span class="hs-identifier hs-var">ifvoid</span></a><span> </span><a href="#local-6989586621679034457"><span class="hs-identifier hs-var">skiset</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Format.html#formatSubs2"><span class="hs-identifier hs-var">formatSubs2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &#8658; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Ski.html#skiabs"><span class="hs-identifier hs-var">skiabs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="NamedLambda.html#nameExp"><span class="hs-identifier hs-var">nameExp</span></a><span> </span><a href="#local-6989586621679034453"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Format.html#end"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621679034460"><a href="#local-6989586621679034460"><span class="hs-identifier">inferredtype</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Stlc.Types.html#typeinference"><span class="hs-identifier hs-var">typeinference</span></a><span> </span><a href="#local-6989586621679034453"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-179"></a><span>                     </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679034465"><a href="#local-6989586621679034465"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="Environment.html#getTopo"><span class="hs-identifier hs-var">getTopo</span></a><span> </span><a href="#local-6989586621679034452"><span class="hs-identifier hs-var">environment</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Stlc.Types.html#Top"><span class="hs-identifier hs-var">Top</span></a><span> </span><a href="#local-6989586621679034465"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679034465"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-180"></a><span>                     </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;Type error!&quot;</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-6989586621679034461"><a href="#local-6989586621679034461"><span class="hs-identifier">typename</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034455"><span class="hs-identifier hs-var">ifvoid</span></a><span> </span><a href="#local-6989586621679034456"><span class="hs-identifier hs-var">typesset</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034455"><span class="hs-identifier hs-var">ifvoid</span></a><span> </span><a href="#local-6989586621679034454"><span class="hs-identifier hs-var">coloring</span></a><span> </span><a href="Format.html#formatType"><span class="hs-identifier hs-var">formatType</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; :: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679034460"><span class="hs-identifier hs-var">inferredtype</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Format.html#end"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679034462"><a href="#local-6989586621679034462"><span class="hs-identifier">expName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Environment.html#getExpressionName"><span class="hs-identifier hs-var">getExpressionName</span></a><span> </span><a href="#local-6989586621679034452"><span class="hs-identifier hs-var">environment</span></a><span> </span><a href="#local-6989586621679034453"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-183"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679034466"><a href="#local-6989586621679034466"><span class="hs-identifier">exname</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679034455"><span class="hs-identifier hs-var">ifvoid</span></a><span> </span><a href="#local-6989586621679034454"><span class="hs-identifier hs-var">coloring</span></a><span> </span><a href="Format.html#formatName"><span class="hs-identifier hs-var">formatName</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &#8658; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679034466"><span class="hs-identifier hs-var">exname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Format.html#end"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-184"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- Parsing of interpreter command line commands.</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Parses an interpreter action.</span><span>
</span><a name="line-189"></a><span class="hs-identifier">interpreteractionParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier hs-type">InterpreterAction</span></a><span>
</span><a name="line-190"></a><a name="interpreteractionParser"><a href="Interpreter.html#interpreteractionParser"><span class="hs-identifier">interpreteractionParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">choice</span><span>
</span><a name="line-191"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="Interpreter.html#interpretParser"><span class="hs-identifier hs-var">interpretParser</span></a><span>
</span><a name="line-192"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="Interpreter.html#quitParser"><span class="hs-identifier hs-var">quitParser</span></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="Interpreter.html#loadParser"><span class="hs-identifier hs-var">loadParser</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">-- | Parses a language action as an interpreter action.</span><span>
</span><a name="line-197"></a><span class="hs-identifier">interpretParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier hs-type">InterpreterAction</span></a><span>
</span><a name="line-198"></a><a name="interpretParser"><a href="Interpreter.html#interpretParser"><span class="hs-identifier">interpretParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#Interpret"><span class="hs-identifier hs-var">Interpret</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Interpreter.html#actionParser"><span class="hs-identifier hs-var">actionParser</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Parses a language action.</span><span>
</span><a name="line-201"></a><span class="hs-identifier">actionParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-202"></a><a name="actionParser"><a href="Interpreter.html#actionParser"><span class="hs-identifier">actionParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">choice</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">try</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-special">[</span><span> </span><a href="Interpreter.html#simpdiagramParser"><span class="hs-identifier hs-var">simpdiagramParser</span></a><span>
</span><a name="line-204"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#diagramParser"><span class="hs-identifier hs-var">diagramParser</span></a><span>
</span><a name="line-205"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#bindParser"><span class="hs-identifier hs-var">bindParser</span></a><span>
</span><a name="line-206"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#evalbindParser"><span class="hs-identifier hs-var">evalbindParser</span></a><span>
</span><a name="line-207"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#executeParser"><span class="hs-identifier hs-var">executeParser</span></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#commentParser"><span class="hs-identifier hs-var">commentParser</span></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#helpParser"><span class="hs-identifier hs-var">helpParser</span></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#restartParser"><span class="hs-identifier hs-var">restartParser</span></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#verboseParser"><span class="hs-identifier hs-var">verboseParser</span></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#colorParser"><span class="hs-identifier hs-var">colorParser</span></a><span>
</span><a name="line-213"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#skiOutputParser"><span class="hs-identifier hs-var">skiOutputParser</span></a><span>
</span><a name="line-214"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#typesParser"><span class="hs-identifier hs-var">typesParser</span></a><span>
</span><a name="line-215"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Interpreter.html#topoParser"><span class="hs-identifier hs-var">topoParser</span></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | Parses a diagram request</span><span>
</span><a name="line-220"></a><span class="hs-identifier">diagramParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-221"></a><a name="diagramParser"><a href="Interpreter.html#diagramParser"><span class="hs-identifier">diagramParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#Diagram"><span class="hs-identifier hs-var">Diagram</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;@ &quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="NamedLambda.html#lambdaexp"><span class="hs-identifier hs-var">lambdaexp</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- | Parses a simplfication and diagram request</span><span>
</span><a name="line-224"></a><span class="hs-identifier">simpdiagramParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-225"></a><a name="simpdiagramParser"><a href="Interpreter.html#simpdiagramParser"><span class="hs-identifier">simpdiagramParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#SimpDiagram"><span class="hs-identifier hs-var">SimpDiagram</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;@@ &quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="NamedLambda.html#lambdaexp"><span class="hs-identifier hs-var">lambdaexp</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- | Parses a binding between a variable an its representation.</span><span>
</span><a name="line-228"></a><span class="hs-identifier">bindParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-229"></a><a name="bindParser"><a href="Interpreter.html#bindParser"><span class="hs-identifier">bindParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Interpreter.html#Bind"><span class="hs-identifier hs-var">Bind</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span>
</span><a name="line-230"></a><span>  </span><span class="hs-identifier hs-var">many1</span><span> </span><span class="hs-identifier hs-var">alphaNum</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span>
</span><a name="line-231"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">choice</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;!=&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;:=&quot;</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="NamedLambda.html#lambdaexp"><span class="hs-identifier hs-var">lambdaexp</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- | Parses a binding and evaluation expression between a variable an its representation</span><span>
</span><a name="line-234"></a><span class="hs-identifier">evalbindParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-235"></a><a name="evalbindParser"><a href="Interpreter.html#evalbindParser"><span class="hs-identifier">evalbindParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Interpreter.html#EvalBind"><span class="hs-identifier hs-var">EvalBind</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">many1</span><span> </span><span class="hs-identifier hs-var">alphaNum</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;=&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="NamedLambda.html#lambdaexp"><span class="hs-identifier hs-var">lambdaexp</span></a><span class="hs-special">)</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">-- | Parses an expression in order to execute it.</span><span>
</span><a name="line-238"></a><span class="hs-identifier">executeParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-239"></a><a name="executeParser"><a href="Interpreter.html#executeParser"><span class="hs-identifier">executeParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#Execute"><span class="hs-identifier hs-var">Execute</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="NamedLambda.html#lambdaexp"><span class="hs-identifier hs-var">lambdaexp</span></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | Parses comments.</span><span>
</span><a name="line-242"></a><span class="hs-identifier">commentParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-243"></a><a name="commentParser"><a href="Interpreter.html#commentParser"><span class="hs-identifier">commentParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;#&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><span class="hs-identifier hs-var">anyChar</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Interpreter.html#Comment"><span class="hs-identifier hs-var">Comment</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-identifier">quitParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier hs-type">InterpreterAction</span></a><span>
</span><a name="line-246"></a><a name="quitParser"><a href="Interpreter.html#quitParser"><span class="hs-identifier">quitParser</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;:quit&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Interpreter.html#Quit"><span class="hs-identifier hs-var">Quit</span></a><span>
</span><a name="line-247"></a><span class="hs-identifier">restartParser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">helpParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-248"></a><a name="restartParser"><a href="Interpreter.html#restartParser"><span class="hs-identifier">restartParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;:restart&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Interpreter.html#Restart"><span class="hs-identifier hs-var">Restart</span></a><span>
</span><a name="line-249"></a><a name="helpParser"><a href="Interpreter.html#helpParser"><span class="hs-identifier">helpParser</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;:help&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Interpreter.html#Help"><span class="hs-identifier hs-var">Help</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Parses a change in a setting</span><span>
</span><a name="line-252"></a><span class="hs-identifier">settingParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-253"></a><a name="settingParser"><a href="Interpreter.html#settingParser"><span class="hs-identifier">settingParser</span></a></a><span> </span><a name="local-6989586621679034467"><a href="#local-6989586621679034467"><span class="hs-identifier">setSetting</span></a></a><span> </span><a name="local-6989586621679034468"><a href="#local-6989586621679034468"><span class="hs-identifier">settingname</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">choice</span><span>
</span><a name="line-254"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="#local-6989586621679034469"><span class="hs-identifier hs-var">settingonParser</span></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">try</span><span> </span><a href="#local-6989586621679034470"><span class="hs-identifier hs-var">settingoffParser</span></a><span>
</span><a name="line-256"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-258"></a><span>    </span><a name="local-6989586621679034469"><a href="#local-6989586621679034469"><span class="hs-identifier">settingonParser</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034468"><span class="hs-identifier hs-var">settingname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; on&quot;</span><span class="hs-special">)</span><span>  </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034467"><span class="hs-identifier hs-var">setSetting</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679034470"><a href="#local-6989586621679034470"><span class="hs-identifier">settingoffParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034468"><span class="hs-identifier hs-var">settingname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; off&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034467"><span class="hs-identifier hs-var">setSetting</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Multiple setting parsers</span><span>
</span><a name="line-262"></a><span class="hs-identifier">verboseParser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">colorParser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">skiOutputParser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">typesParser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">topoParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#Action"><span class="hs-identifier hs-type">Action</span></a><span>
</span><a name="line-263"></a><a name="verboseParser"><a href="Interpreter.html#verboseParser"><span class="hs-identifier">verboseParser</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#settingParser"><span class="hs-identifier hs-var">settingParser</span></a><span> </span><a href="Interpreter.html#SetVerbose"><span class="hs-identifier hs-var">SetVerbose</span></a><span> </span><span class="hs-string">&quot;:verbose&quot;</span><span>
</span><a name="line-264"></a><a name="colorParser"><a href="Interpreter.html#colorParser"><span class="hs-identifier">colorParser</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#settingParser"><span class="hs-identifier hs-var">settingParser</span></a><span> </span><a href="Interpreter.html#SetColor"><span class="hs-identifier hs-var">SetColor</span></a><span>   </span><span class="hs-string">&quot;:color&quot;</span><span>
</span><a name="line-265"></a><a name="skiOutputParser"><a href="Interpreter.html#skiOutputParser"><span class="hs-identifier">skiOutputParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#settingParser"><span class="hs-identifier hs-var">settingParser</span></a><span> </span><a href="Interpreter.html#SetSki"><span class="hs-identifier hs-var">SetSki</span></a><span>     </span><span class="hs-string">&quot;:ski&quot;</span><span>
</span><a name="line-266"></a><a name="typesParser"><a href="Interpreter.html#typesParser"><span class="hs-identifier">typesParser</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#settingParser"><span class="hs-identifier hs-var">settingParser</span></a><span> </span><a href="Interpreter.html#SetTypes"><span class="hs-identifier hs-var">SetTypes</span></a><span>   </span><span class="hs-string">&quot;:types&quot;</span><span>
</span><a name="line-267"></a><a name="topoParser"><a href="Interpreter.html#topoParser"><span class="hs-identifier">topoParser</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#settingParser"><span class="hs-identifier hs-var">settingParser</span></a><span> </span><a href="Interpreter.html#SetTopo"><span class="hs-identifier hs-var">SetTopo</span></a><span>    </span><span class="hs-string">&quot;:topology&quot;</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-comment">-- | Parses a &quot;load-file&quot; command.</span><span>
</span><a name="line-271"></a><span class="hs-identifier">loadParser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><a href="Interpreter.html#InterpreterAction"><span class="hs-identifier hs-type">InterpreterAction</span></a><span>
</span><a name="line-272"></a><a name="loadParser"><a href="Interpreter.html#loadParser"><span class="hs-identifier">loadParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Interpreter.html#Load"><span class="hs-identifier hs-var">Load</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">string</span><span> </span><span class="hs-string">&quot;:load&quot;</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">between</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">many1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">satisfy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a></pre></body></html>